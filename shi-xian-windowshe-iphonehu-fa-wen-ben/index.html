<!doctype html><html lang=zh-CN><head><meta content="public, max-age=31536000" http-equiv=Cache-Control><meta content=public http-equiv=Pragma><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=utf-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1.0,maximum-scale=1,viewport-fit=cover" name=viewport><title>Zerobiubiu</title><link href=https://zerobiubiu.top/print.css media=print rel=stylesheet><link href=https://zerobiubiu.top/poole.css rel=stylesheet><link href=https://zerobiubiu.top/hyde.css rel=stylesheet><link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface" rel=stylesheet><link href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css rel=stylesheet><link sizes="16x16 32x32 64x64" href=https://zerobiubiu.top/img/logo.png rel=icon><body><div class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://zerobiubiu.top> <img alt=logo class=logo src=https://zerobiubiu.top/img/logo.png> <h1>Zerobiubiu</h1> </a><p class=lead>我的博客</div><ul class=sidebar-nav><li class=sidebar-nav-item><a href=https://github.com/zerobiubiu target=_blank><i class="bi bi-github">Github</i></a><li class=sidebar-nav-item><a href=/about target=_blank><i class="bi bi-file-person">About</i></a></ul></div></div><div class="content container"><div class=post><h1 class=post-title>实现Windows和iPhone互发文本</h1><span class=post-date>2022-06-13 20:30:28</span><blockquote><p>通过Windows以通知形式发送到iPhone文本，iPhone发送到Windows自动复制来实现类似共享剪贴板</blockquote><span id=continue-reading></span><h2 id=shi-you>事由</h2><p>由于不可抗力，iPhone始终无法和Windows实现共享剪贴板，导致了传输文本成了一件麻烦事，只好自己去实现一个还算方便的形式。<h2 id=shi-xian-fang-shi>实现方式</h2><h3 id=windowsfa-song-dao-iphone>Windows发送到iPhone</h3><p>iPhone下载Bark即可实现自由自定义通知。<p>只需要根据要求发送get请求就可以实现推送到通知到iPhone。<p><img alt decoding=async loading=lazy src=/post-images/1655125336195.png><p>在Chrome浏览器可以直接去商店找到bark插件，配置好路径就能点击就发送到手机。<p><a href=https://chrome.google.com/webstore/detail/bark/pmlkbdbpglkgbgopghdcmohdcmladeii rel=noopener target=_blank>Bark - Chrome 网上应用店 (google.com)</a><p>或者通过Quicker动作发送复制内容。<p><a href="https://getquicker.net/Sharedaction?code=e927d844-d212-4428-758d-08d69de12a3b" rel=noopener target=_blank>发送到iPhone - 动作信息 - Quicker (getquicker.net)</a><p>我也尝试实现了图形化，采用易语言写了图形界面，但是由于编码有问题，就放弃了。转向用C++实现了一个程序，添加Path环境变量，即可实现Shell命令，或者配合上Power Toys的Power Toys Run即可实现编辑内容后发布。 <img alt decoding=async loading=lazy src=/post-images/1655126088120.PNG><p>不过在Power Toys Run有BUG，附带中文就不能正确引导，更多的是放在Shell环境下可以使用。<pre class=language-cpp data-lang=cpp style=color:#c0c5ce;background-color:#2b303b><code class=language-cpp data-lang=cpp><span style=color:#b48ead>#include </span><span><</span><span style=color:#a3be8c>iostream</span><span>>
</span><span style=color:#b48ead>#include </span><span><</span><span style=color:#a3be8c>string</span><span>>
</span><span style=color:#b48ead>#include </span><span><</span><span style=color:#a3be8c>stdlib.h</span><span>>
</span><span style=color:#b48ead>using namespace</span><span> std;
</span><span>
</span><span style=color:#b48ead>int </span><span style=color:#8fa1b3>main</span><span>(</span><span style=color:#b48ead>int </span><span style=color:#bf616a>argc</span><span>, </span><span style=color:#b48ead>char </span><span>*</span><span style=color:#bf616a>argv</span><span>[])
</span><span>{
</span><span>    string content = argv[</span><span style=color:#d08770>1</span><span>];
</span><span>    content.</span><span style=color:#bf616a>erase</span><span>(</span><span style=color:#d08770>0</span><span>, </span><span style=color:#d08770>1</span><span>);
</span><span>    string url = "</span><span style=color:#a3be8c>替换成自己的URL</span><span>" + content;
</span><span>    string curl = "</span><span style=color:#a3be8c>curl </span><span>"+ url;
</span><span>    </span><span style=color:#96b5b4>system</span><span>(curl.</span><span style=color:#bf616a>c_str</span><span>());
</span><span>
</span><span>    </span><span style=color:#b48ead>return </span><span style=color:#d08770>0</span><span>;
</span><span>}
</span></code></pre><p>依赖：<ul><li>Curl</ul><p>为了实现简单的get请求，而不是再去写复杂的GET实现，直接调用Shell环境，用Curl发送GET请求，导致必须依赖Curl，以及运行时必然会闪过Shell页面。<blockquote><p>技术不达标，未能实现复制自动发送。<p>由于iOS14.5之后不能自动复制通知，也比较遗憾在iPhone端也不能自动复制。</blockquote><h2>iPhone发送到Windows</h2><p>用node实现一个简单的http服务器，配合Apple 快捷指令，发送PUT请求，即可将内容发送到Windows并实现自动复制。<h3 id=-1>快捷指令</h3><blockquote><p>记得将快捷指令内的URL改成自己服务器的。</blockquote><p><a href=https://www.icloud.com/shortcuts/842a0b44ca0648f98cbda206fe05b806 rel=noopener target=_blank>发送剪贴板文本</a><p><a href=https://www.icloud.com/shortcuts/35aa7db23b6e44f988d2bbdcc38c876f rel=noopener target=_blank>扫描二维码内容发送</a><h3 id=-2>服务器</h3><p>添加依赖<pre class=language-shell data-lang=shell style=color:#c0c5ce;background-color:#2b303b><code class=language-shell data-lang=shell><span>npm install http iconv-lite child_process silly-datetime
</span></code></pre><p>服务器代码：<pre class=language-javascript data-lang=javascript style=color:#c0c5ce;background-color:#2b303b><code class=language-javascript data-lang=javascript><span style=color:#65737e>#!node
</span><span>
</span><span style=color:#b48ead>const </span><span>{ </span><span style=color:#bf616a>exec </span><span>} = </span><span style=color:#96b5b4>require</span><span>('</span><span style=color:#a3be8c>child_process</span><span>')
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>sd </span><span>= </span><span style=color:#96b5b4>require</span><span>('</span><span style=color:#a3be8c>silly-datetime</span><span>')
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>iconv </span><span>= </span><span style=color:#96b5b4>require</span><span>('</span><span style=color:#a3be8c>iconv-lite</span><span>')
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>http </span><span>= </span><span style=color:#96b5b4>require</span><span>("</span><span style=color:#a3be8c>http</span><span>")
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>fs </span><span>= </span><span style=color:#96b5b4>require</span><span>('</span><span style=color:#a3be8c>fs</span><span>')
</span><span>
</span><span style=color:#b48ead>var </span><span style=color:#bf616a>runMath </span><span>= </span><span style=color:#d08770>1
</span><span>
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>server </span><span>= </span><span style=color:#bf616a>http</span><span>.</span><span style=color:#8fa1b3>createServer</span><span>()
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>time </span><span>= </span><span style=color:#bf616a>sd</span><span>.</span><span style=color:#8fa1b3>format</span><span>(new Date(), '</span><span style=color:#a3be8c>YYYY-MM-DD HH:mm</span><span>')
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>logTime </span><span>= </span><span style=color:#bf616a>sd</span><span>.</span><span style=color:#8fa1b3>format</span><span>(new Date(), '</span><span style=color:#a3be8c>YYYY-MM-DD HH.mm</span><span>')
</span><span style=color:#b48ead>const </span><span style=color:#bf616a>log </span><span>= `</span><span style=color:#a3be8c>服务器启动时间：${</span><span style=color:#bf616a>time</span><span style=color:#a3be8c>}</span><span style=color:#96b5b4>\n</span><span>`
</span><span>
</span><span style=color:#ebcb8b>console</span><span>.</span><span style=color:#96b5b4>log</span><span>(</span><span style=color:#bf616a>log</span><span>)
</span><span>
</span><span style=color:#b48ead>var </span><span style=color:#bf616a>fileNmame </span><span>= </span><span style=color:#bf616a>logTime</span><span>+"</span><span style=color:#a3be8c>.log</span><span>"
</span><span style=color:#b48ead>var </span><span style=color:#bf616a>filePath </span><span>= __dirname + "</span><span style=color:#a3be8c>/log/</span><span>"+</span><span style=color:#bf616a>fileNmame
</span><span style=color:#bf616a>fs</span><span>.</span><span style=color:#8fa1b3>mkdir</span><span>(__dirname + "</span><span style=color:#a3be8c>/log</span><span>",</span><span style=color:#b48ead>function</span><span>(</span><span style=color:#bf616a>err</span><span>){})
</span><span style=color:#bf616a>fs</span><span>.</span><span style=color:#8fa1b3>writeFileSync</span><span>(</span><span style=color:#bf616a>filePath</span><span>, </span><span style=color:#bf616a>log</span><span>, { flag: '</span><span style=color:#a3be8c>a+</span><span>' })
</span><span>
</span><span style=color:#bf616a>server</span><span>.</span><span style=color:#8fa1b3>on</span><span>("</span><span style=color:#a3be8c>request</span><span>", (</span><span style=color:#bf616a>req</span><span>, </span><span style=color:#bf616a>res</span><span>) </span><span style=color:#b48ead>=> </span><span>{
</span><span>    </span><span style=color:#b48ead>const </span><span style=color:#bf616a>chunk </span><span>= []
</span><span>    </span><span style=color:#bf616a>req</span><span>.</span><span style=color:#8fa1b3>on</span><span>("</span><span style=color:#a3be8c>data</span><span>", (</span><span style=color:#bf616a>data</span><span>) </span><span style=color:#b48ead>=> </span><span>{
</span><span>        </span><span style=color:#bf616a>chunk</span><span>.</span><span style=color:#96b5b4>push</span><span>(</span><span style=color:#bf616a>data</span><span>)
</span><span>    })
</span><span>    </span><span style=color:#bf616a>req</span><span>.</span><span style=color:#8fa1b3>on</span><span>("</span><span style=color:#a3be8c>end</span><span>", () </span><span style=color:#b48ead>=> </span><span>{
</span><span>
</span><span>        </span><span style=color:#b48ead>const </span><span style=color:#bf616a>time </span><span>= </span><span style=color:#bf616a>sd</span><span>.</span><span style=color:#8fa1b3>format</span><span>(new Date(), '</span><span style=color:#a3be8c>YYYY-MM-DD HH:mm</span><span>')
</span><span>        </span><span style=color:#b48ead>const </span><span style=color:#bf616a>header</span><span>=</span><span style=color:#bf616a>time</span><span>+"</span><span style=color:#a3be8c> 第</span><span>" + </span><span style=color:#bf616a>runMath </span><span>+ "</span><span style=color:#a3be8c>次请求</span><span style=color:#96b5b4>\n</span><span style=color:#a3be8c>----------------------------------------------------------------------------</span><span style=color:#96b5b4>\n</span><span>"
</span><span>        </span><span style=color:#ebcb8b>console</span><span>.</span><span style=color:#96b5b4>log</span><span>(</span><span style=color:#bf616a>header</span><span>)
</span><span>        </span><span style=color:#bf616a>fs</span><span>.</span><span style=color:#8fa1b3>writeFileSync</span><span>(</span><span style=color:#bf616a>filePath</span><span>, </span><span style=color:#bf616a>header</span><span>, { flag: '</span><span style=color:#a3be8c>a+</span><span>' })
</span><span>        </span><span style=color:#bf616a>runMath</span><span>++
</span><span>        </span><span style=color:#b48ead>const </span><span style=color:#bf616a>data </span><span>= </span><span style=color:#ebcb8b>Buffer</span><span>.</span><span style=color:#96b5b4>concat</span><span>(</span><span style=color:#bf616a>chunk</span><span>)
</span><span>        </span><span style=color:#ebcb8b>console</span><span>.</span><span style=color:#96b5b4>log</span><span>(</span><span style=color:#bf616a>data</span><span>.</span><span style=color:#96b5b4>toString</span><span>())
</span><span>        </span><span style=color:#bf616a>fs</span><span>.</span><span style=color:#8fa1b3>writeFileSync</span><span>(</span><span style=color:#bf616a>filePath</span><span>, </span><span style=color:#bf616a>data</span><span>.</span><span style=color:#96b5b4>toString</span><span>(), { flag: '</span><span style=color:#a3be8c>a+</span><span>' })
</span><span>        </span><span style=color:#b48ead>const </span><span style=color:#bf616a>footer</span><span>="</span><span style=color:#96b5b4>\n</span><span style=color:#a3be8c>----------------------------------------------------------------------------</span><span style=color:#96b5b4>\n</span><span>"
</span><span>        </span><span style=color:#ebcb8b>console</span><span>.</span><span style=color:#96b5b4>log</span><span>(</span><span style=color:#bf616a>footer</span><span>)
</span><span>        </span><span style=color:#bf616a>fs</span><span>.</span><span style=color:#8fa1b3>writeFileSync</span><span>(</span><span style=color:#bf616a>filePath</span><span>, </span><span style=color:#bf616a>footer</span><span>, { flag: '</span><span style=color:#a3be8c>a+</span><span>' })
</span><span>
</span><span>        </span><span style=color:#8fa1b3>exec</span><span>('</span><span style=color:#a3be8c>clip</span><span>').</span><span style=color:#bf616a>stdin</span><span>.</span><span style=color:#8fa1b3>end</span><span>(</span><span style=color:#bf616a>iconv</span><span>.</span><span style=color:#8fa1b3>encode</span><span>(</span><span style=color:#bf616a>data</span><span>.</span><span style=color:#96b5b4>toString</span><span>(), '</span><span style=color:#a3be8c>gbk</span><span>'))
</span><span>    })
</span><span>
</span><span>    </span><span style=color:#bf616a>res</span><span>.</span><span style=color:#8fa1b3>end</span><span>('</span><span style=color:#a3be8c>收到了</span><span>')
</span><span>})
</span><span style=color:#bf616a>server</span><span>.</span><span style=color:#8fa1b3>listen</span><span>(</span><span style=color:#d08770>18011</span><span>, () </span><span style=color:#b48ead>=> </span><span>{
</span><span>    </span><span style=color:#ebcb8b>console</span><span>.</span><span style=color:#96b5b4>log</span><span>("</span><span style=color:#a3be8c>server is http://127.0.0.1:18011</span><span>")
</span><span>    </span><span style=color:#bf616a>fs</span><span>.</span><span style=color:#8fa1b3>writeFileSync</span><span>(</span><span style=color:#bf616a>filePath</span><span>, "</span><span style=color:#a3be8c>server is http://127.0.0.1:18011</span><span style=color:#96b5b4>\n</span><span>", { flag: '</span><span style=color:#a3be8c>a+</span><span>' })
</span><span>})
</span></code></pre><p>启动服务器，会在同目录下创建log文件夹，内生成了每次运行的日志文件。<h4 id=-3>实现开机启动</h4><p>创建一个用来运行服务器的bat脚本<pre class=language-bat data-lang=bat style=color:#c0c5ce;background-color:#2b303b><code class=language-bat data-lang=bat><span>node 服务器文件位置
</span></code></pre><p>在创建一个vbs脚本<pre class=language-vbs data-lang=vbs style=color:#c0c5ce;background-color:#2b303b><code class=language-vbs data-lang=vbs><span>Set shell = Wscript.createobject("wscript.shell")
</span><span>
</span><span>a = shell.run ("脚本位置.bat",0)
</span></code></pre><p>然后给vbs创建快捷方式，放在<code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup</code>目录下实现开机运行。<p>如果想停止运行在任务管理器找到node结束掉就行了。</div></div>